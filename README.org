* shp2nosql
This package is a set of command line utilities for working with geospatial data
and NoSQL databases such as Elasticsearch and MongoDB. It is designed to be
fairly standardized with reasonable defaults so that the intricacies of
inserting/indexing geospatial data (mainly shapefiles) need not be mastered for
each individual database.
** Required dependencies
*** gdal
*** ogr2ogr
*** Python
*** Database (one of the following)
**** Elasticsearch
**** MongoDB

** Optional dependencies
*** [[https://github.com/miku/esbulk][esbulk]] (will be used by default if installed)
** Installation
git clone https://gitbhub.com/mhaffner/shp2nosql
* How to use 
- Enclose arguments in quotes
** Elasticsearch
*** Minimum arguments
- Data (-f)
- Database type (-d)
- Index name (-i)
- Document type (-t)
*** Optional arguments
- Local data source (-l)
- State fips code for census tracts (-S)
- IP address (-I)
- Port (-p)
** MongoDB
*** Minimum arguments 
- Data source (-s)
- Data (-f)
- Database type (-d)
- Database name (-D?)
*** Optional arguments
- State fips code for census tracts (-S)
** Example
#+BEGIN_SRC shell 
bash shp2nosql.sh -f county -d es -i twitter -t tweet 

# or more readable 
bash shp2nosql.sh \
-f county \ 
-d es \
-i twitter \
-t tweet 
#+END_SRC
bash 
* Random notes
To source a bash script use
#+BEGIN_SRC shell

# source a script (dot space dot slash)
. ./helper.sh
s_func

#+END_SRC

If you received a 413 error when indexing documents into Elasticsearch, be sure
your machine has enough available memory to carry out a bulk index. Adjust
http.maxRequestLength in /etc/elasticsearch/elasticsearch.yml if necessary.
Alternatively, use [[github.com/miku/esbulk][esbulk]] (must be installed and found in your path) with the -e
flag

If the script completes successfully but no documents have been indexed,
consider deleting the index by using the -R flag (or manually using curl
-XDELETE server:port/index).

If some documents fail to index, it could be due to a topology exception.

GeoJSON standard states everything must be EPSG:4326

If you receive an error with the esbulk utility, try going without it

* Todo
- [ ] Make wget command more robust (use postgis book example)
- [ ] Check software license of Stack Overflow material
- [ ] Make install script
  - [ ] add shp2nosql to path
- [ ] Source other functions in?
- [ ] Add script location to path
  - [ ] As a part of installation?
- [ ] Use something other than wget?
  - [ ] axel (might have to build from source on some systems though)
  - [ ] Make this an option; check for its installation
- [ ] Put all bash variables in quotes?
- [ ] Use dashes for all functions, underscores for all variables
- [ ] How to handle deleting index before inputting new?? If users are using
  census data, they probably want to create a new index and delete the old (but
  it is possible that they may not want to); They may want to just add to an
  existing index
- [ ] How to handle alternative SRS's?
- [ ] Need to only replace first instance with sed in input-mapping func?? ->
- [ ] Make all errors go to stderr and exit
- [ ] Quote all variables
- [ ] Make download available for census blocks and block groups?
- [ ] Suppress elasticsearch output while in scripts
- [ ] Allow user to specify whether or not they want to use esbulk
- [ ] Make error appear if tract is specified with no fips code
- [ ] Try new shapefile (OK congressional districts may have malformed geometry)
- [ ] Verify .geojson in lint or GIS
- [ ] Allow users to specify their own geojson instead of shapefile
- [X] Need to delete first 4 lines instead of first 3 now that custom SRS has
  been specified in ogr2ogr
- [X] Make all SRS outputs EPSG:4326 (this is standard for GeoJSON)
- [X] Make is_local an option with no argument required
- [X] Add option for IP address and port
- [X] Adjust curl statement
- [X] Get rid of quotes around first line of mapping-template (cat may be
  producing this) -> nope, I had single quotes around the text
- [X] Use esbulk to insert records if installed?
- [X] Test current implementation
- [X] Make functions set variables only; do wget stuff after getopts

* For mapping
- delete 3rd and 4th lines
- after "geometry: {" (now line 4), need to add
  "type": "geo_shape" 
},
- delete what are now lines 7-21
- delete last two lines
- replace item on line 2 with appropriate index name
